# 20211026

## 先週の予定

積み残し:
- [ ] 関連研究の整理および調査
  - [x] 実験データセット整理(これまで調べた分で)
- [ ] Kleespectreの実行(優先度:低)
  - 興味深いのがあれば
- [ ] Spectre論文(優先度:低)
  - side-cahnnel attack 周りで参考になるかも

以下新規:
- [x] SpecTaint[NDSS'21]
  - [x] patternベースの手法の理解
  - [x] 再現実装(の検討)
    - Pin で実装できそうなら Pin で実装する
- [ ] Cache関連の調査
  - [CacheQuery](https://dl.acm.org/doi/abs/10.1145/3385412.3386008)[PLDI'20]
  - [Theory and Practice of Finding Eviction Sets](https://ieeexplore.ieee.org/document/8835261)[SP'19]
  - [ ] その他リストアップ(KLEEspectreから?)
- 以下は直近で読む予定
  - [ ] [Abstract Interpretation](https://dl.acm.org/doi/10.1145/3314221.3314647)
    - 抽象解釈の手法、静的解析を頑張ってるやつ
  - [ ] [Constant-Time for the New Era](https://www.ndss-symposium.org/ndss-paper/spectaint-speculative-taint-analysis-for-discovering-spectre-gadgets/)
    - 記号実行系の手法
  - [ ] [Automatically eliminating speculative leaks from cryptographic code with blade](https://dl.acm.org/doi/10.1145/3434330)
    - 型に基づく手法


## 研究課題(Spectre V1)

```
void victim_fucntion(size_t user_input)
{
  ...
    if (user_input < get_len(array1)) {  // VB
      secret = array1[user_input];       // RS
      temp &= array2[secret * 256];      // LS
    }
}

int main()
{
  victim_fucntion(user_input);
  return 0;
}
```

## 調査

### 関連研究比較

- [SpreadSheet](https://docs.google.com/spreadsheets/d/1gMd3cJuJoKmvqdo0cslBIlYkgMvHiPlqocJlVkDouJQ/edit#gid=0)
  - 実験データセットのシートの追加

### SpecTaint[NDSS'21]の概要

[SpecTaint Algorithm in Google Slides](https://docs.google.com/presentation/d/1TWmJJgjKxkFw919-wsBUyIXqJrGo6b75PRKSYOfJ6rc/edit#slide=id.p)

アルゴリズムの概要
1. テスト(seeds)を作成
   - fuzzer, symbol execution を用いる
1. ユーザー入力をtaintする
   - user-controllable な変数を見つけるため
1. DECAF(QEMU上で動く)でemulate
   - conditional branch が来たら投機的実行を行う
     - 実行とは反対側のブランチを実行(SEWまで)([slide](https://docs.google.com/presentation/d/1TWmJJgjKxkFw919-wsBUyIXqJrGo6b75PRKSYOfJ6rc/edit#slide=id.gcb5ceb0c71_0_13))
     - gadgetを見つけたら記録([slide](https://docs.google.com/presentation/d/1TWmJJgjKxkFw919-wsBUyIXqJrGo6b75PRKSYOfJ6rc/edit#slide=id.gfae32c9ce3_0_18))

### (再)実装の検討(第一案)

- DECAF++の利用を一旦は決めたものの、諸問題を発見してPinに方針転換
  - メンテされていない
  - (wikiが怪しい)
  - Pinはドキュメントがある(PBAを含め)
  - Pinは枯れている
- 基本的な実装方針は以下(SpecTaintベース)
  - 通常実行(NE)と投機実行(SE)の切り替えは Pin の Context を差し替えることで実現できそう
    - [Generic modification API](https://software.intel.com/sites/landingpage/pintool/docs/98437/Pin/html/group__INS__MODIFICATION.html)
    - [Context manipulation API](https://software.intel.com/sites/landingpage/pintool/docs/98437/Pin/html/group__CONTEXT.html)
    - [Physical context manipulation API](https://software.intel.com/sites/landingpage/pintool/docs/98437/Pin/html/group__PHYSICAL__CONTEXT.html)
  - ただしメモリの変更は記録しておいて、NEに切り替えるときに逆順で戻す
  - テイント解析を行うときはテイント情報も保存＆復元

所感
- 実装で沼りそう（特にNEとSEの切り替え）
- 柔軟性に欠ける
  - 実装の変更が難しそう

### 実装の検討(二段構成)

arahori先生提案の二段構成

1. fuzz/symbexで実行させる。各分岐に対して以下の情報を保存
   - 分岐直前の実行状態
   - 分岐後のメモリアクセス命令
     - テイント解析を行う場合は、オペランドがテイントされたもののみを集める？
   - その他必要に応じて（要議論
1. 保存した情報を元にSpectre脆弱性を見つける
   - キャッシュモデルを組む場合、保存した命令列で*エミュレートする*

所感
- 複数stepに分けることで柔軟性アップ
  - 再現実装にとどまらず、これをベースに提案手法を実装できそう


## 今後の予定

- [ ] 再現実装
  - [ ] 方針の確定
  - [ ] 技術選定
  - [ ] ベースラインの作成
- [ ] [Abstract Interpretation](https://dl.acm.org/doi/10.1145/3314221.3314647)[PLDI'19]
  - [ ] 概要の把握
  - [ ] アルゴリズムの理解
  - [ ] 実験と評価
- [ ] [CacheQuery](https://dl.acm.org/doi/abs/10.1145/3385412.3386008)[PLDI'20]
  - [ ] 概要の把握
  - [ ] アルゴリズムの把握

直近で行う予定
- [ ] Cache関連の調査
  - [CacheQuery](https://dl.acm.org/doi/abs/10.1145/3385412.3386008)[PLDI'20]
  - [Theory and Practice of Finding Eviction Sets](https://ieeexplore.ieee.org/document/8835261)[SP'19]
  - [ ] その他リストアップ(KLEEspectreから?)
- 以下は直近で読む予定
  - [ ] [Abstract Interpretation](https://dl.acm.org/doi/10.1145/3314221.3314647)
    - 抽象解釈の手法、静的解析を頑張ってるやつ
  - [ ] [Constant-Time for the New Era](https://www.ndss-symposium.org/ndss-paper/spectaint-speculative-taint-analysis-for-discovering-spectre-gadgets/)
    - 記号実行系の手法
  - [ ] [Automatically eliminating speculative leaks from cryptographic code with blade](https://dl.acm.org/doi/10.1145/3434330)
    - 型に基づく手法

## memo

### 1019

Done:
- taintを用いたパターンベースのルールは理解した
- datasetの表を作成した

Impression:
- Gadget検出においては、静的taintより動的taintの方がよい
  - 精度よし(特にRecallが良い)
  - 静的taintは静的由来の不利な点が多い
    - over tainting, under tainting
- 精度評価でinserted gadgetのみに対して論じており、恣意感が否めないがGTがわからないのでしょうがない

### 1020

Done:
- evaluation読了
  - recallが高い

Impression:
- 関数単位でtaint解析しておき、全体の処理の時には処理済みのを使いたい
  - 関数間の呼び出しの解決が必要そう
  - どの引数をtaintするかを決める必要がある。
    - use-def解析?
    - global変数の処理も必要
  - そもそもフローによってtait結果が変わってくるので無理じゃね？

### 1021

Done:
- SpecTaintの再現実装の検討
  - DECAF++の利用を決定

Impression:
- 関係ないがqilingというフレームワーク面白そう

### 1022

Done:
- Pinを調べた
  - decaf++のrepoを見たが、メンテされていないので使わない方が良さそう
  - Pinはドキュメントもあるし、pbaでもやっている

### 1023
Done:
- 再現実装を考えていた

### 1024

### 1025
